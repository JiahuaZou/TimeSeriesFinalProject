---
title: "153projcode"
author: "Zhengyi Sui"
date: "5/4/2019"
output: html_document
---

```{r}
library(ggplot2)
library(astsa)
library(TSA)
library(knitr)
```


```{r setup, include=FALSE}
dat1 <- read.csv("stat153_final_project/data1.csv")
colnames(dat1) <- c("time", "value")
value1 <- dat1$value
```

1. EDA
```{r}
summary(dat1)
ggplot(data = dat1) +
  geom_line(aes(x = time, y = value)) +
  geom_point(aes(x = time, y = value), size = 0.7) +
  scale_x_continuous(breaks = seq(0, 180, by = 20)) +
  scale_y_continuous(breaks = seq(0.8, 2.3, by = 0.15)) +
  xlab("time") +
  ylab("value") +
  ggtitle("Original trend of data 1") +
  theme_minimal()
# both log and sqrt doesn't have decent result
value_log <- log(value1)
plot(value_log, type = "l")
plot(diff(value_log), type = "l")

value_sqrt <- sqrt(value1)
plot(value_sqrt, type = "l")
plot(diff(value_sqrt), type = "l")

# try diffence
value_df1 <- diff(value1)
plot(value_df1, type = "l")

acf2(value_df1)
```

```{r}
diff_log_1 <- diff(value_log)

acf(diff_log_1)

periodogram(diff_log_1)
```

```{r}
periodogram(diff_log_1)$freq


```

```{r}

CVgeneric <- function(data, k = 10, p = 1, d = 1, q = 1, P = 1, D = 1, Q = 1,
                      S = 12) {
  mse <- numeric()
  
  g <- length(data) %/% k
  for (i in 3:(k - 1)) {
    train_set <- data[1:(i * g)]
    if (i == k - 1) {
      val_set <- data[(i*g):length(data)]
    } else {
      val_set <- data[(i*g):((i+1)*g)]
    }
    y_pred <- sarima.for(train_set, n.ahead = length(val_set), p, d, q, P, D, Q, S)
    mse <- c(mse, sum((y_pred$pred - val_set)^2))
  }
  return(mean(mse))
}

```

```{r, fig.show = "hide"}
print(CVgeneric(value_log, D = 0))
print(CVgeneric(value_log))
print(CVgeneric(value_log, q = 0))
```


```{r, fig.show = "hide"}
print(CVgeneric(value_log, D = 0, d = 0))
print(CVgeneric(value_log, d = 0))
print(CVgeneric(value_log, q = 0, d = 0))
```

```{r}
print(CVgeneric(diff_log_1, d = 0, D = 0))
print(CVgeneric(diff_log_1, d = 0))
print(CVgeneric(diff_log_1, d = 0, q = 0))
```
```{r}
print(CVgeneric(value_log))
print(CVgeneric(value_log, d = 0))
```




